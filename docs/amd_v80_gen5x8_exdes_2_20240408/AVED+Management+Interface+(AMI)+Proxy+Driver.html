<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script charset="UTF-8" data-document-language="true" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" type="text/javascript"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script class="optanon-category-C0002" type="text/plain">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
<title>AVED Management Interface (AMI) Proxy Driver — AVED  documentation</title>
<link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="_static/xbtest.css" rel="stylesheet" type="text/css"/>
<link href="_static/_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="https://docs.xilinx.com/favicon.ico" rel="shortcut icon"/>
<!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/js/theme.js"></script>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="AVED%2BProgramming%2BControl%2B%28APC%29%2BProxy%2BDriver.html" rel="next" title="AVED Programming Control (APC) Proxy Driver"/>
<link href="AVED%2BOutOfBand%2BTelemetry%2BApplication.html" rel="prev" title="AVED OutOfBand Telemetry Application"/>
<link href="_static/conf.css" rel="stylesheet" type="text/css"/></head>
<body class="wy-body-for-nav">
<!-- Google Tag Manager -->
<noscript><iframe class="optanon-category-C0002" height="0" src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" style="display:none;visibility:hidden" width="0"></iframe></noscript>
<!-- End Google Tag Manager -->
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="index.html"> AVED
            <img alt="Logo" class="logo" src="_static/xilinx-header-logo.svg"/>
</a>
<div role="search">
<form action="search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption" role="heading"><span class="caption-text">AVED v80 Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BOverview.html">AVED Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AVED Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="How-to%2Binstall%2Band%2Brun%2Ba%2Bpre-built%2BAVED%2Bdesign%2Bon%2Ban%2BALVEO%2Bcard.html">How-to install and run a pre-built AVED design on an ALVEO card</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to%2BRebuild%2Ban%2BAVED%2BDesign%2Bfor%2BYourself.html">How-to Rebuild an AVED Design for Yourself</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AVED System Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2B-%2BBoard%2BManagement%2BSolution.html">AVED - Board Management Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2B-%2BDevice%2BProgramming.html">AVED - Device Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2B-%2BHost%2Bto%2BCard%2BCommunication.html">AVED - Host to Card Communication</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AVED Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BDeployment%2BArchive.html">AVED Deployment Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BInstalling%2Bthe%2BDeployment%2Bpackage%2Bonto%2Bthe%2BHost%2BServer.html">AVED Installing the Deployment package onto the Host Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BInstalling%2Bthe%2BDesign%2Bonto%2Bthe%2BCard.html">AVED Installing the Design onto the Card</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BUpdating%2BFPT%2BImage%2Bin%2BFlash.html">AVED Updating FPT Image in Flash</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BUpdating%2BDesign%2BPDI%2Bin%2BFlash.html">AVED Updating Design PDI in Flash</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BDebug%2BTechniques.html">AVED Debug Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BJTAG%2BBoot%2BRecovery.html">AVED JTAG Boot Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BManagement%2BInterface%2Buserguide%2B%28ami_tool%29.html">AVED Management Interface userguide (ami_tool)</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtest/user-guide/source/index.html">Xbtest Userguide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BBuild%2BScripts.html">AVED Build Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Source%2BConfiguration%2BControl.html">Source Configuration Control</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Design - V80</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BHierarchy%2BOverview.html">AVED V80 - Hierarchy Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BCIPS%2BConfiguration.html">AVED V80 - CIPS Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BMemory%2BResources.html">AVED V80 - Memory Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BMemory%2BMap.html">AVED V80 - Memory Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BNoC%2BConfiguration.html">AVED V80 - NoC Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BBase%2BLogic.html">AVED V80 - Base Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BClock%2BReset%2BModule.html">AVED V80 - Clock Reset Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BV80%2B-%2BSource%2BFile%2BOverview.html">AVED V80 - Source File Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Generic%2BCommand%2BQueue%2BIP%2Bv2.0%2B-%2BProduct%2BGuide.html">Generic Command Queue IP v2.0 - Product Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hardware%2BDiscovery%2BIP%2Bv1.0%2B-%2BProduct%2BGuide.html">Hardware Discovery IP v1.0 - Product Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="SMBus%2BIP%2Bv1.1%2B-%2BProduct%2BGuide.html">SMBus IP v1.1 - Product Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firmware Design - AVED</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="AVED%2BManagement%2BController%2B%28AMC%29%2B-%2BArchitecture%2Band%2BDesign.html">AVED Management Controller (AMC) - Architecture and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BASDM%2BApplication.html">AVED ASDM Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BInBand%2BTelemetry%2BApplication.html">AVED InBand Telemetry Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BOutOfBand%2BTelemetry%2BApplication.html">AVED OutOfBand Telemetry Application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">AVED Management Interface (AMI) Proxy Driver</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proxy-driver-external-apis">Proxy Driver External APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialize-the-ami-proxy-driver">Initialize the AMI proxy driver.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bind-callbacks">Bind Callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdi-download-response">PDI Download Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdi-copy-response">PDI Copy Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sensor-complete-response">Sensor Complete Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avedmanagementinterface-ami-proxydriver-identityresponse">Identity Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-select-response">Boot Select Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eeprom-read-write-response">EEPROM read/write Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-read-write-response">Module read/write Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debug-verbosity-response">Debug Verbosity Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdi-download-request">PDI Download Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdi-copy-request">PDI Copy Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sensor-request">Sensor Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-select-request">Boot Select Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eeprom-read-write-request">Eeprom Read Write Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-read-write-request">Module Read Write Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debug-verbosity-request">Debug Verbosity Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#print-statistics">Print Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clear-statistics">Clear Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sequence-diagrams">Sequence Diagrams</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ami-proxy-initialization">AMI Proxy Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ami-proxy-task">AMI Proxy Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ami-handling-requests">AMI Handling Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ami-handling-responses">AMI Handling Responses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialize-driver">Initialize Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register-for-callback">Register For Callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-responses">Generating Responses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-requests">Handling Requests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BProgramming%2BControl%2B%28APC%29%2BProxy%2BDriver.html">AVED Programming Control (APC) Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BSensor%2BControl%2B%28ASC%29%2BProxy%2BDriver.html">AVED Sensor Control (ASC) Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BExternal%2BDevice%2BControl%2B%28AXC%29%2BProxy%2BDriver.html">AVED External Device Control (AXC) Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board%2BManagement%2BController%2B%28BMC%29%2BProxy%2BDriver.html">Board Management Controller (BMC) Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="Firmware%2BInterface%2B%28FW_IF%29%2BAbstraction%2BLayer.html">Firmware Interface (FW_IF) Abstraction Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operating%2BSystem%2BAbstraction%2BLayer%2B%28OSAL%29.html">Operating System Abstraction Layer (OSAL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Profiles%2Band%2BCMake%2Bbuild%2Bprocess.html">Profiles and CMake build process</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Services (AMI)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BManagement%2BInterface%2B%28AMI%29.html">AVED Management Interface (AMI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BQDMA.html">AVED QDMA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AVED%2B-%2BList%2Bof%2BAbbreviations.html">AVED - List of Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="AVED%2BRelease%2BInformation.html">AVED Release Information</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top" style="background: black">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="index.html">AVED</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a class="icon icon-home" href="index.html"></a> »</li>
<li>AVED Management Interface (AMI) Proxy Driver</li>
<li class="wy-breadcrumbs-aside">
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<section id="aved-management-interface-ami-proxy-driver">
<h1>AVED Management Interface (AMI) Proxy Driver<a class="headerlink" href="#aved-management-interface-ami-proxy-driver" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<span id="avedmanagementinterface-ami-proxydriver-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The AMI proxy driver binds in the FAL provided in the initialization and uses this to read requests and write responses back to handle communication to/from the host.</p>
<p>Internally it creates a number of resources, including a mutex for protection, a mailbox to handle asynchronous responses and a task to handle the interaction with the FAL.</p>
<p>The task spawned will:</p>
<ul class="simple">
<li><p>Read requests from the FAL store data associated with the host request internally (using an unique id) and generate event via the EVL to anyone registered for the callback.</p></li>
<li><p>Service the internal mailbox and handle writing data back to the FAL for the host responses.</p></li>
</ul>
<p>The API consists of a number of functions to get the AMI request data, these will be called when the application receives the relevant event via the EVL, once the relevant action has been performed the matching response function can be invoked with
the same unique id received in the request. The response API’s will then post an internal message with the data required for the host responses to onto the mailbox and then thread will service this mailbox and form up the response back to the host.</p>
<p>The API also provides a few debug function to handle display and clear of the stat/error counters.</p>
</section>
<section id="proxy-driver-external-apis">
<span id="avedmanagementinterface-ami-proxydriver-proxydriverexternalapis"></span><h2>Proxy Driver External APIs<a class="headerlink" href="#proxy-driver-external-apis" title="Permalink to this headline">¶</a></h2>
<section id="initialize-the-ami-proxy-driver">
<span id="avedmanagementinterface-ami-proxydriver-initializetheamiproxydriver"></span><h3>Initialize the AMI proxy driver.<a class="headerlink" href="#initialize-the-ami-proxy-driver" title="Permalink to this headline">¶</a></h3>
<p>This will open the FAL using the handle provided in the API (pxFwIf) &amp; make use of the OSAL layer to create a mutex, a mailbox and a task.</p>
<p><strong>iAMI_Initialise</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Main initialisation point for the AMI Proxy Driver</span>
<span class="cm"> *</span>
<span class="cm"> * @param   ucProxyId   Unique ID for this Proxy driver</span>
<span class="cm"> * @param   pxFwIf      Handle to the Firmware Interface to use</span>
<span class="cm"> * @param   ulFwIfPort  Port to use on the Firmware Interface</span>
<span class="cm"> * @param   ulTaskPrio  Priority of the Proxy driver task (if RR disabled)</span>
<span class="cm"> * @param   ulTaskStack Stack size of the Proxy driver task</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Proxy driver initialised correctly</span>
<span class="cm"> *          ERROR       Proxy driver not initialised, or was already initialised</span>
<span class="cm"> *</span>
<span class="cm"> * @notes   Proxy drivers can have 0 or more firmware interfaces</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_Initialise</span><span class="p">(</span> <span class="n">uint8_t</span> <span class="n">ucProxyId</span><span class="p">,</span>
                     <span class="n">FW_IF_CFG</span> <span class="o">*</span><span class="n">pxFwIf</span><span class="p">,</span>
                     <span class="n">uint32_t</span> <span class="n">ulFwIfPort</span><span class="p">,</span>
                     <span class="n">uint32_t</span> <span class="n">ulTaskPrio</span><span class="p">,</span>
                     <span class="n">uint32_t</span> <span class="n">ulTaskStack</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="bind-callbacks">
<span id="avedmanagementinterface-ami-proxydriver-bindcallbacks"></span><h3>Bind Callbacks<a class="headerlink" href="#bind-callbacks" title="Permalink to this headline">¶</a></h3>
<p>This API can be used to bind into a callback to be notified of events generated by the AMI proxy using the EVL library. The current supported events are:</p>
<ul class="simple">
<li><p><strong>AMI_PROXY_DRIVER_E_PDI_DOWNLOAD_START</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_PDI_COPY_START</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_SENSOR_READ</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_GET_IDENTITY</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_BOOT_SELECT</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_HEARTBEAT</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_EEPROM_READ_WRITE</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_MODULE_READ_WRITE</strong></p></li>
<li><p><strong>AMI_PROXY_DRIVER_E_DEBUG_VERBOSITY</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br/></div>
</div>
<p><strong>iAMI_BindCallback</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Bind into this proxy driver</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxCallback  Callback to bind into the proxy driver</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Callback successfully bound</span>
<span class="cm"> *          ERROR       Callback not bound</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_BindCallback</span><span class="p">(</span> <span class="n">EVL_CALLBACK</span> <span class="o">*</span><span class="n">pxCallback</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pdi-download-response">
<span id="avedmanagementinterface-ami-proxydriver-pdidownloadresponse"></span><h3>PDI Download Response<a class="headerlink" href="#pdi-download-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a response back over the FAL that the PDI download request has completed successfully/failed.</p>
<p><strong>iAMI_SetPdiDownloadCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Set Functions **************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * @brief   Set the response after the PDI download has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the pdi download request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetPdiDownloadCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pdi-copy-response">
<span id="avedmanagementinterface-ami-proxydriver-pdicopyresponse"></span><h3>PDI Copy Response<a class="headerlink" href="#pdi-copy-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a response back over the FAL that the PDI copy request has completed successfully/failed.</p>
<p><strong>iAMI_SetPdiCopyCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Set the response after the PDI copy has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the pdi copy request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetPdiCopyCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="sensor-complete-response">
<span id="avedmanagementinterface-ami-proxydriver-sensorcompleteresponse"></span><h3>Sensor Complete Response<a class="headerlink" href="#sensor-complete-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a response back over the FAL that the sensor read request has completed successfully/failed.</p>
<p><strong>iAMI_SetSensorCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Set the response after the sensor request has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the sensor request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetSensorCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="avedmanagementinterface-ami-proxydriver-identityresponse">
<span id="identity-response"></span><h3>Identity Response<a class="headerlink" href="#avedmanagementinterface-ami-proxydriver-identityresponse" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a response back over the FAL that the identity read request has completed successfully/failed.</p>
<p><strong>iAMI_SetIdentityResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Set the identity response</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult                 The result of the identity request</span>
<span class="cm"> * @param   pxIdentityResponse      The structure containing the version information</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                      Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR                   Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetIdentityResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span><span class="p">,</span> <span class="n">AMI_PROXY_IDENTITY_RESPONSE</span> <span class="o">*</span><span class="n">pxIdentity</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="boot-select-response">
<span id="avedmanagementinterface-ami-proxydriver-bootselectresponse"></span><h3>Boot Select Response<a class="headerlink" href="#boot-select-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a back over the FAL that the boot select request has completed successfully/failed.</p>
<p><strong>iAMI_SetBootSelectCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Set the response after the Boot select has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the boot select request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetBootSelectCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="eeprom-read-write-response">
<span id="avedmanagementinterface-ami-proxydriver-eepromread-writeresponse"></span><h3>EEPROM read/write Response<a class="headerlink" href="#eeprom-read-write-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a back over the FAL that the EEPROM read/write request has completed successfully/failed.</p>
<p><strong>iAMI_SetEepromReadWriteCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Set the response after the EEPROM read/write has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the boot select request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetEepromReadWriteCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="module-read-write-response">
<span id="avedmanagementinterface-ami-proxydriver-moduleread-writeresponse"></span><h3>Module read/write Response<a class="headerlink" href="#module-read-write-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a back over the FAL that the Module read/write request has completed successfully/failed.</p>
<p><strong>iAMI_SetModuleReadWriteCompleteResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief Set the response after the module read/write has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param pxSignal Current event occurance (used for tracking)</span>
<span class="cm"> * @param xResult The result of the module rd/wr request</span>
<span class="cm"> *</span>
<span class="cm"> * @return OK Data passed to proxy driver successfully</span>
<span class="cm"> * ERROR Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetModuleReadWriteCompleteResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
</section>
<section id="debug-verbosity-response">
<span id="avedmanagementinterface-ami-proxydriver-debugverbosityresponse"></span><h3>Debug Verbosity Response<a class="headerlink" href="#debug-verbosity-response" title="Permalink to this headline">¶</a></h3>
<p>This will post a message onto the mailbox to be handled within the the internal task to send a back over the FAL that the debug verbosity request has completed successfully/failed.</p>
<p><strong>iAMI_SetDebugVerbosityResponse</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Set the response after the debug verbosity request has completed</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   xResult     The result of the debug verbosity request</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Data passed to proxy driver successfully</span>
<span class="cm"> *          ERROR       Data not passed successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_SetDebugVerbosityResponse</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pdi-download-request">
<span id="avedmanagementinterface-ami-proxydriver-pdidownloadrequest"></span><h3>PDI Download Request<a class="headerlink" href="#pdi-download-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the PDI download request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetPdiDownloadRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Get the PDI download request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                Current event occurrence (used for tracking)</span>
<span class="cm"> * @param   pxDownloadRequest       Pointer to download pdi structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                      Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                   Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetPdiDownloadRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_PDI_DOWNLOAD_REQUEST</span> <span class="o">*</span><span class="n">pxDownloadRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pdi-copy-request">
<span id="avedmanagementinterface-ami-proxydriver-pdicopyrequest"></span><h3>PDI Copy Request<a class="headerlink" href="#pdi-copy-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the PDI copy request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetPdiCopyRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Get the PDI copy request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                Current event occurrence (used for tracking)</span>
<span class="cm"> * @param   pxCopyRequest           Pointer to copy pdi structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                      Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                   Data not retrieved successfully</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetPdiCopyRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span>
                            <span class="n">AMI_PROXY_PDI_COPY_REQUEST</span> <span class="o">*</span><span class="n">pxCopyRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="sensor-request">
<span id="avedmanagementinterface-ami-proxydriver-sensorrequest"></span><h3>Sensor Request<a class="headerlink" href="#sensor-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the Get Sensor request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetSensorRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Get the Sensor request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                Current event occurrence (used for tracking)</span>
<span class="cm"> * @param   pxSensorRequest         Pointer sensor request structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                      Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                   Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetSensorRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_SENSOR_REQUEST</span> <span class="o">*</span><span class="n">pxSensorRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="boot-select-request">
<span id="avedmanagementinterface-ami-proxydriver-bootselectrequest"></span><h3>Boot Select Request<a class="headerlink" href="#boot-select-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the boot selection request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetBootSelectRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Get the Boot Select request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                Current event occurance (used for tracking)</span>
<span class="cm"> * @param   pxBootSelectRequest     Pointer boot select request structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                      Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                   Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetBootSelectRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_BOOT_SELECT_REQUEST</span> <span class="o">*</span><span class="n">pxBootSelectRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="eeprom-read-write-request">
<span id="avedmanagementinterface-ami-proxydriver-eepromreadwriterequest"></span><h3>Eeprom Read Write Request<a class="headerlink" href="#eeprom-read-write-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the EEPROM read write request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetEepromReadWriteRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Get the eeprom read write request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   pxEepromReadWriteRequest    Pointer sensor request structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                          Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                       Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetEepromReadWriteRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span>
                                    <span class="n">AMI_PROXY_EEPROM_RW_REQUEST</span> <span class="o">*</span><span class="n">pxEepromReadWriteRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="module-read-write-request">
<span id="avedmanagementinterface-ami-proxydriver-modulereadwriterequest"></span><h3>Module Read Write Request<a class="headerlink" href="#module-read-write-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the Module read write request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetModuleReadWriteRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief Get the module read write request</span>
<span class="cm"> *</span>
<span class="cm"> * @param pxSignal Current event occurance (used for tracking)</span>
<span class="cm"> * @param pxModuleReadWriteRequest Pointer sensor request structure</span>
<span class="cm"> *</span>
<span class="cm"> * @return OK Data retrieved from proxy driver successfully</span>
<span class="cm"> * ERROR Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetModuleReadWriteRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">AMI_PROXY_MODULE_RW_REQUEST</span> <span class="o">*</span><span class="n">pxModuleReadWriteRequest</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="debug-verbosity-request">
<span id="avedmanagementinterface-ami-proxydriver-debugverbosityrequest"></span><h3>Debug Verbosity Request<a class="headerlink" href="#debug-verbosity-request" title="Permalink to this headline">¶</a></h3>
<p>This API will be used by the application to obtain the data associated with the debug verbosity request, which is stored internally within the proxy before the event is raised.</p>
<p><strong>iAMI_GetDebugVerbosityRequest</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief   Get the debug verbosity request</span>
<span class="cm"> *</span>
<span class="cm"> * @param   pxSignal                    Current event occurance (used for tracking)</span>
<span class="cm"> * @param   pucDebugVerbosityRequest    Pointer to store requested debug verbosity</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK                          Data retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR                       Data not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_GetDebugVerbosityRequest</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span><span class="p">,</span> <span class="n">uint8_t</span> <span class="o">*</span><span class="n">pucDebugVerbosityRequest</span> <span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
</section>
<section id="print-statistics">
<span id="avedmanagementinterface-ami-proxydriver-printstatistics"></span><h3>Print Statistics<a class="headerlink" href="#print-statistics" title="Permalink to this headline">¶</a></h3>
<p>Debug function used to display the statistic counters and errors.</p>
<p><strong>iAMI_PrintStatistics</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Print all the stats gathered by the application</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Stats retrieved from proxy driver successfully</span>
<span class="cm"> *          ERROR       Stats not retrieved successfully</span>
<span class="cm"> *</span>
<span class="cm"> * @notes   None</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_PrintStatistics</span><span class="p">(</span> <span class="kt">void</span> <span class="p">);</span>
</pre></div>
</div>
<p>Example output:</p>
<p><img alt="image1" class="confluence-embedded-image" src="_images/1118241196.png"/></p>
</section>
<section id="clear-statistics">
<span id="avedmanagementinterface-ami-proxydriver-clearstatistics"></span><h3>Clear Statistics<a class="headerlink" href="#clear-statistics" title="Permalink to this headline">¶</a></h3>
<p>Debug function used to clear the all statistics counters back to zero.</p>
<p><strong>iAMI_ClearStatistics</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * @brief   Clear all the stats in the application</span>
<span class="cm"> *</span>
<span class="cm"> * @return  OK          Stats cleared successfully</span>
<span class="cm"> *          ERROR       Stats not cleared successfully</span>
<span class="cm"> *</span>
<span class="cm"> * @notes   None</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iAMI_ClearStatistics</span><span class="p">(</span> <span class="kt">void</span> <span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
</section>
</section>
<section id="sequence-diagrams">
<span id="avedmanagementinterface-ami-proxydriver-sequencediagrams"></span><h2>Sequence Diagrams<a class="headerlink" href="#sequence-diagrams" title="Permalink to this headline">¶</a></h2>
<section id="ami-proxy-initialization">
<span id="avedmanagementinterface-ami-proxydriver-amiproxyinitialization"></span><h3>AMI Proxy Initialization<a class="headerlink" href="#ami-proxy-initialization" title="Permalink to this headline">¶</a></h3>
<p>The initialization function (iAMI_Initialise) is called from the main task when all the other proxies are being initialized.</p>
<p>It obtains a handle to the FAL and creates the resources needed by the driver including spawning the AMI proxy task.</p>
<p><a class="drawio-diagram-image reference internal" href="_images/8d14dd62a9e5341b21a40f3117327548bfa318d7.png"><img alt="image2" class="drawio-diagram-image" src="_images/8d14dd62a9e5341b21a40f3117327548bfa318d7.png" style="width: 891px;"/></a></p>
</section>
<section id="ami-proxy-task">
<span id="avedmanagementinterface-ami-proxydriver-amiproxytask"></span><h3>AMI Proxy Task<a class="headerlink" href="#ami-proxy-task" title="Permalink to this headline">¶</a></h3>
<p>The task within the AMI proxy has two different responsibilities:</p>
<ul class="simple">
<li><p>To check for requests incoming via the FAL.</p></li>
<li><p>To service the internal mailbox and form up responses to go back out to the FAL.</p></li>
</ul>
<p><a class="drawio-diagram-image reference internal" href="_images/56fab7689e19eec90197d7af312a4a37464ef16b.png"><img alt="image3" class="drawio-diagram-image" src="_images/56fab7689e19eec90197d7af312a4a37464ef16b.png" style="width: 731px;"/></a></p>
</section>
<section id="ami-handling-requests">
<span id="avedmanagementinterface-ami-proxydriver-amihandlingrequests"></span><h3>AMI Handling Requests<a class="headerlink" href="#ami-handling-requests" title="Permalink to this headline">¶</a></h3>
<p>The request API’s allows an application to get a copy of the internal proxy request data received via the FAL.</p>
<ul class="simple">
<li><p>iAMI_GetPdiDownloadRequest( )</p></li>
<li><p>iAMI_GetSensorRequest( )</p></li>
</ul>
<p>The requests data is stored within the AMI proxy when the event is generated and the callback has been invoked to notify any registered users.</p>
<p>When the request from the application is made a protected copy of the data is made and returned that will allow the user to perform the relevant action.</p>
<p><a class="drawio-diagram-image reference internal" href="_images/754c2915fab58943c7d6068112fe90a3aa6760bc.png"><img alt="image4" class="drawio-diagram-image" src="_images/754c2915fab58943c7d6068112fe90a3aa6760bc.png" style="width: 596px;"/></a></p>
</section>
<section id="ami-handling-responses">
<span id="avedmanagementinterface-ami-proxydriver-amihandlingresponses"></span><h3>AMI Handling Responses<a class="headerlink" href="#ami-handling-responses" title="Permalink to this headline">¶</a></h3>
<p>The response API’s are used by the application to respond back to the request with data/result code once the relevant action has been performed.</p>
<ul class="simple">
<li><p>iAMI_SetPdiDownloadCompleteResponse( )</p></li>
<li><p>iAMI_SetSensorCompleteResponse( )</p></li>
<li><p>iAMI_SetIdentityResponse( )</p></li>
</ul>
<p>Within each response a mailbox message is formed with the unique instance id, the type, and the result and posted to be handled by the internal task.</p>
<p><a class="drawio-diagram-image reference internal" href="_images/edb213b65e3b3792e4834f9be27bedb4723703a1.png"><img alt="image5" class="drawio-diagram-image" src="_images/edb213b65e3b3792e4834f9be27bedb4723703a1.png" style="width: 596px;"/></a></p>
</section>
</section>
<section id="examples">
<span id="avedmanagementinterface-ami-proxydriver-examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<section id="initialize-driver">
<span id="avedmanagementinterface-ami-proxydriver-initializedriver"></span><h3>Initialize Driver<a class="headerlink" href="#initialize-driver" title="Permalink to this headline">¶</a></h3>
<p>The initialize function needs a unique id for the proxy, a handle to a FW_IF (already created and initialized), and a task priority/size passed in.</p>
<p><strong>iAMI_Initialise Example</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span>#define AMC_EVENT_UNIQUE_ID_AMI ( 1 )   /* each proxy needs an unique id */
#define AMC_TASK_PRIO_DEFAULT   ( 5 )
#define AMC_TASK_DEFAULT_STACK  ( 0x1024 )

/* NOTE: The handle to the FW_IF needs to have been initialised and created before being passed in */
if( OK == iAMI_Initialise( AMC_EVENT_UNIQUE_ID_AMI, &amp;myIf, 0, AMC_TASK_PRIO_DEFAULT, AMC_TASK_DEFAULT_STACK ) )
{
    printf( "AMI Proxy Driver initialised\r\n" );
}
else
{
    printf( "Error initialising AMI Proxy Driver\r\n" );
}
</pre></div>
</div>
</section>
<section id="register-for-callback">
<span id="avedmanagementinterface-ami-proxydriver-registerforcallback"></span><h3>Register For Callback<a class="headerlink" href="#register-for-callback" title="Permalink to this headline">¶</a></h3>
<p>Define a function based on the function pointer prototype and bind in using the API.</p>
<p><strong>iAMI_BindCallback Example</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Define a callback to handle the events */</span>
<span class="kt">int</span> <span class="nf">iAmiCallback</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">iStatus</span> <span class="o">=</span> <span class="n">ERROR</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">NULL</span> <span class="o">!=</span> <span class="n">pxSignal</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"AMI Proxy Driver (0x%02X), Instance %d\r\n"</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucModule</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucInstance</span> <span class="p">);</span>

        <span class="k">switch</span><span class="p">(</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucEventType</span> <span class="p">)</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_SENSOR_READ</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_PDI_DOWNLOAD_STAMI</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_GET_IDENTITY</span><span class="p">:</span>
            <span class="cm">/* TODO: handle the events */</span>
            <span class="n">iStatus</span> <span class="o">=</span> <span class="n">OK</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">default</span><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iStatus</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Bind into the callback during the application initialisation */</span>
<span class="kt">int</span> <span class="nf">iApplication_Initialise</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">iStatus</span> <span class="o">=</span> <span class="n">ERROR</span><span class="p">;</span>

    <span class="cm">/* The rest of init depending on application before or after the callback binding */</span>

    <span class="n">iStatus</span> <span class="o">=</span> <span class="n">iAMI_BindCallback</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">iAmiCallback</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">OK</span> <span class="o">==</span> <span class="n">iStatus</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"AMI Proxy Driver bound\r\n"</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"Error binding to AMI Proxy Driver\r\n"</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iStatus</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="generating-responses">
<span id="avedmanagementinterface-ami-proxydriver-generatingresponses"></span><h3>Generating Responses<a class="headerlink" href="#generating-responses" title="Permalink to this headline">¶</a></h3>
<p>Example of calling the response (<strong>iAMI_SetSensorCompleteResponse</strong>) from within the callback to send the result back towards the host.</p>
<p><strong>iAMI_SetSensorCompleteResponse Example</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Define a callback to handle the events */</span>
<span class="kt">int</span> <span class="nf">iAmiCallback</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">iStatus</span> <span class="o">=</span> <span class="n">ERROR</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">NULL</span> <span class="o">!=</span> <span class="n">pxSignal</span> <span class="p">)</span>
    <span class="p">{</span>   <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="o">=</span> <span class="n">AMI_PROXY_RESULT_INVALID_ARG</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"AMI Proxy Driver (0x%02X), Instance %d\r\n"</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucModule</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucInstance</span> <span class="p">);</span>

        <span class="k">switch</span><span class="p">(</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucEventType</span> <span class="p">)</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_SENSOR_READ</span><span class="p">:</span>
            <span class="cm">/* TODO: collect the sensor data */</span>

            <span class="cm">/* TODO: Set the result code based on the collection */</span>

            <span class="cm">/* Send the response back using same pxSignal structure passed into callback &amp; the result */</span>
            <span class="n">iStatus</span> <span class="o">=</span> <span class="n">iAMI_SetSensorCompleteResponse</span><span class="p">(</span> <span class="n">pxSignal</span><span class="p">,</span> <span class="n">xResult</span> <span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_PDI_DOWNLOAD_STAMI</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_GET_IDENTITY</span><span class="p">:</span>
            <span class="cm">/* TODO: handle the other events */</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">default</span><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iStatus</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="handling-requests">
<span id="avedmanagementinterface-ami-proxydriver-handlingrequests"></span><h3>Handling Requests<a class="headerlink" href="#handling-requests" title="Permalink to this headline">¶</a></h3>
<p>Example of requesting the data associated with an event (<strong>iAMI_GetSensorRequest</strong>) from within the callback and to send the result back towards the host.</p>
<p><strong>iAMI_GetSensorRequest Example</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Define a callback to handle the events */</span>
<span class="kt">int</span> <span class="nf">iAmiCallback</span><span class="p">(</span> <span class="n">EVL_SIGNAL</span> <span class="o">*</span><span class="n">pxSignal</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">iStatus</span> <span class="o">=</span> <span class="n">ERROR</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">NULL</span> <span class="o">!=</span> <span class="n">pxSignal</span> <span class="p">)</span>
    <span class="p">{</span>   <span class="n">AMI_PROXY_RESULT</span> <span class="n">xResult</span> <span class="o">=</span> <span class="n">AMI_PROXY_RESULT_INVALID_ARG</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"AMI Proxy Driver (0x%02X), Instance %d\r\n"</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucModule</span><span class="p">,</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucInstance</span> <span class="p">);</span>

        <span class="k">switch</span><span class="p">(</span> <span class="n">pxSignal</span><span class="o">-&gt;</span><span class="n">ucEventType</span> <span class="p">)</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_SENSOR_READ</span><span class="p">:</span>
            <span class="n">iStatus</span> <span class="o">=</span> <span class="n">iAMI_GetSensorRequest</span><span class="p">(</span> <span class="n">pxSignal</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">xSensorRequest</span> <span class="p">);</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">OK</span> <span class="o">==</span> <span class="n">iStatus</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/* TODO: use data from xSensorRequest to collect the correct sensor data */</span>

                <span class="cm">/* Set the result code based on the collection */</span>
                <span class="n">xResult</span> <span class="o">=</span> <span class="n">AMI_PROXY_RESULT_SUCCESS</span><span class="p">;</span>

                <span class="cm">/* Send the response back using same pxSignal structure passed into callback &amp; the result*/</span>
                <span class="n">iStatus</span> <span class="o">=</span> <span class="n">iAMI_SetSensorCompleteResponse</span><span class="p">(</span> <span class="n">pxSignal</span><span class="p">,</span> <span class="n">xResult</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_PDI_DOWNLOAD_STAMI</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">AMI_PROXY_DRIVER_E_GET_IDENTITY</span><span class="p">:</span>
            <span class="cm">/* TODO: handle the other events */</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">default</span><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iStatus</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Page Revision: v. 52</p>
</section>
</section>
</section>
</div>
</div>
<footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="AVED%2BOutOfBand%2BTelemetry%2BApplication.html" rel="prev" title="AVED OutOfBand Telemetry Application"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
<a accesskey="n" class="btn btn-neutral float-right" href="AVED%2BProgramming%2BControl%2B%28APC%29%2BProxy%2BDriver.html" rel="next" title="AVED Programming Control (APC) Proxy Driver">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<p>© Copyright 2023, Advanced Micro Devices Inc.</p>
</div>
<div class="aem-Grid aem-Grid--16">
<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
<div class="container-fluid sub-footer">
<div class="row">
<div class="col-xs-24">
<p><a href="https://www.amd.com/en/corporate/copyright" target="_blank">Terms and Conditions</a> | <a href="https://www.amd.com/en/corporate/privacy" target="_blank">Privacy</a> | <a href="https://www.amd.com/en/corporate/cookies" target="_blank">Cookie Policy</a> | <a href="https://www.amd.com/en/corporate/trademarks" target="_blank">Trademarks</a> | <a href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf" target="_blank">Statement on Forced Labor</a> | <a href="https://www.amd.com/en/corporate/competition" target="_blank">Fair and Open Competition</a> | <a href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf" target="_blank">UK Tax Strategy</a> | <a href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA" target="_blank">Inclusive Terminology</a> | <a class="ot-sdk-show-settings" href="#cookiessettings">Cookies Settings</a></p>
</div>
</div>
</div>
</div>
</div>



  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>
</body>
</html>